<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Scatambulo" />
    <link rel="apple-touch-icon" href="/img/icons/apple-touch-icon.png" />
    <meta http-equiv="Content-Security-Policy"
      content="
      default-src 'self';
      frame-src https://*.firebaseio.com https://vercel.live;
      script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://cdn.jsdelivr.net https://*.firebaseio.com https://www.gstatic.com https://cdnjs.cloudflare.com;
      style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://unpkg.com https://fonts.googleapis.com https://cdnjs.cloudflare.com https://server.arcgisonline.com https://*.arcgisonline.com;
      font-src * data:;
      img-src 'self' data: https://*.tile.openstreetmap.org https://server.arcgisonline.com https://*.arcgisonline.com blob:;
      connect-src 'self' wss://*.firebaseio.com https://www.gstatic.com https://viacep.com.br https://nominatim.openstreetmap.org https://*.openstreetmap.org https://router.project-osrm.org https://unpkg.com https://server.arcgisonline.com https://*.arcgisonline.com blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://firebasestorage.googleapis.com https://storage.googleapis.com https://scatambulo-d7cf2.firebasestorage.app;
      worker-src 'self' blob:;
    ">
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/chat.css" />
    <link
      href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css"
      rel="stylesheet"
    />

    <script src="https://unpkg.com/@phosphor-icons/web"></script>
  </head>
  <body>
    <header>
      <div class="header-container">
        <h1>Painel da Sofia üßÅ</h1>
        <div class="desktop-nav">
          <button id="new-order-button" class="btn-primary">
            <i class="ph ph-plus-circle"></i> Novo Pedido
          </button>
          <button id="read-message-button" class="btn-primary">
            <i class="ph ph-envelope-open"></i> Ler Mensagem
          </button>
          <button id="chat-button" class="btn-primary">
            <i class="ph ph-chat-text"></i> Conversas
          </button>
          <button id="order-history-button" class="btn-secondary">
            <i class="ph ph-clock-counter-clockwise"></i> Hist√≥rico
          </button>
          <button id="logout-button" class="btn-secondary">
            <i class="ph ph-sign-out"></i> Sair
          </button>
        </div>
        <button class="hamburger-menu" aria-label="Menu">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </button>
      </div>
    </header>
    <nav class="mobile-nav">
      <div class="divider"></div>
    </nav>
    <main class="container">
      <section id="map-section">
        <h2><i class="ph ph-map-pin"></i> Rastreamento Entregador</h2>
        <div id="map-container" aria-label="Mapa de acompanhamento">
          <div class="map-loading-overlay active">
            <div class="map-spinner"></div>
          </div>
          <div id="map"></div>
          <div class="map-interaction-overlay" id="map-overlay"></div>

          <div id="map-overlay-top" class="map-overlay-top-entregador">
            <div class="map-info-item map-info-item-border-right">
              <div id="distance-display" class="map-info-value">-- km</div>
              <div class="map-info-label">Dist√¢ncia</div>
            </div>
            <div class="map-info-item">
              <div id="eta-display" class="map-info-value">-- min</div>
              <div class="map-info-label">ETA</div>
            </div>
            <div class="map-info-item map-info-item-border-left">
              <div id="speed-display" class="map-info-value">-- km/h</div>
              <div class="map-info-label">Veloc.</div>
            </div>
          </div>

          <!-- HUD de Navega√ß√£o (Seguir / Sat√©lite / 3D) -->
          <div id="nav-hud" class="nav-hud-admin">
            <div class="hud-controls">
              <button
                id="map-fullscreen-btn"
                class="btn-secondary"
                title="Tela Cheia"
              >
                <i class="ph ph-arrows-out"></i>
              </button>
              <button
                id="follow-entregador-button"
                class="btn-secondary"
                title="Seguir Entregador"
              >
                <i class="ph ph-compass"></i>
              </button>
              <button
                id="satellite-toggle"
                class="btn-secondary"
                title="Modo Sat√©lite"
              >
                <i class="ph ph-globe"></i>
              </button>
              <button
                id="toggle-3d"
                class="btn-secondary"
                title="Visualiza√ß√£o 3D"
              >
                <i class="ph ph-cube"></i>
              </button>
            </div>
          </div>
        </div>
      </section>

      <section id="orders-section" style="margin-top: 30px">
        <h2><i class="ph ph-list-checks"></i> Pedidos</h2>
        <div id="kanban-board"></div>
      </section>
    </main>

    <div id="modal-container"></div>
    <div id="toast-container"></div>

    <style>
      /* Estilos para o loading do mapa */
      #map-container {
        position: relative; /* Necess√°rio para o overlay */
      }
      .map-loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #eef0f2;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 5;
        border-radius: 8px;
        transition: opacity 0.5s ease;
        opacity: 1;
        color: var(--cor-texto-secundario, #555);
        font-weight: 500;
      }
      .map-loading-overlay:not(.active) {
        opacity: 0;
        pointer-events: none;
      }
      .map-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #ccc;
        border-top-color: var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 15px;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>

    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script
      type="module"
      src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"
    ></script>
    <script type="module" src="js/config.js"></script>
    <script type="module" src="js/firebase.js"></script>
    <script type="module" src="js/utils.js"></script>
    <script type="module" src="js/ui.js"></script>
    <script type="module" src="js/map.js"></script>
    <script type="module" src="js/ui-confeiteira.js"></script>
    <script type="module" src="js/componentLoader.js"></script>
    <script type="module" src="js/confeiteira.js"></script>
  </body>
</html>
