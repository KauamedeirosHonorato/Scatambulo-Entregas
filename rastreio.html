<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rastrear Pedido - Scatambulo</title>
    <link
      href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link rel="stylesheet" href="css/style.css" />
    <style>
      body {
        background-color: var(
          --cor-secundaria
        ); /* Cinza claro para combinar com o tema */
        padding-bottom: var(
          --safe-bottom
        ); /* Adiciona espaço na parte inferior para a home bar do iOS */
      }
      .tracking-container {
        max-width: 600px;
        margin: 40px auto;
        padding: 30px;
        background-color: var(--cor-principal);
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05);
        text-align: center;
      }
      .search-box {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      #order-code-input {
        flex-grow: 1;
        text-transform: uppercase;
      }
      #order-details-section {
        text-align: left;
        margin-top: 30px;
        padding-top: 30px;
        border-top: 1px solid #eee;
      }
      .status-timeline {
        display: flex;
        justify-content: space-between;
        margin-bottom: 30px;
        position: relative;
      }
      .status-timeline::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 10%;
        right: 10%;
        height: 2px;
        background-color: #e0e0e0;
        transform: translateY(-50%);
        z-index: 1;
      }
      .status-step {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        z-index: 2;
        width: 80px;
      }
      .status-icon {
        width: 32px;
        height: 32px;
        margin-bottom: 8px;
        opacity: 0.3;
        transition: opacity 0.3s ease;
      }
      .status-step.active .status-icon,
      .status-step.completed .status-icon {
        opacity: 1;
      }

      /* Animação de pulso para o ícone ativo */
      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.15);
        }
        100% {
          transform: scale(1);
        }
      }

      /* Aplica a animação ao ícone dentro do passo ativo, mas não se for o último passo (entregue) */
      .status-step.active:not([data-status="entregue"]) .status-icon {
        animation: pulse 1.5s infinite;
      }

      .status-dot {
        width: 20px;
        height: 20px;
        background-color: #e0e0e0;
        border-radius: 50%;
        margin-bottom: 8px;
        transition: background-color 0.3s ease;
      }
      .status-step.active .status-dot {
        background-color: var(--primary-color);
      }
      .status-step.completed .status-dot {
        background-color: var(--success-color);
      }
      .status-label {
        font-size: 0.8rem;
        color: #888;
      }
      .status-step.active .status-label,
      .status-step.completed .status-label {
        color: #333;
        font-weight: 600;
      }
      #map-container {
        height: 400px;
        border-radius: 8px;
        margin-top: 20px;
        border: 2px solid var(--cor-destaque);
        padding: 5px;
        background-color: var(--cor-destaque);
      }
      #rastreio-map {
        height: 100%;
        width: 100%;
        border-radius: 6px;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-container">
        <h1>Rastrear Pedido</h1>
        <nav>
          <a href="index.html" class="btn-secondary">Voltar</a>
        </nav>
      </div>
    </header>
    <main class="container">
      <div class="tracking-container">
        <h2>Insira o Código do Pedido</h2>
        <div class="search-box">
          <input
            type="text"
            id="order-code-input"
            placeholder="Ex: ABC123DE"
            maxlength="8"
          />
          <button id="track-order-button" class="btn-primary">Rastrear</button>
        </div>
        <p id="tracking-message" class="error-message"></p>

        <section id="order-details-section" style="display: none">
          <h3>
            Status do Pedido
            <span
              id="order-id-display"
              style="font-weight: 300; color: var(--ios-text-sec)"
            ></span>
          </h3>
          <div class="status-timeline">
            <div class="status-step" data-status="em_preparo">
              <img
                src="img/icons/EmPreparo.png"
                alt="Em Preparo"
                class="status-icon"
              />
              <span class="status-label">Em Preparo</span>
            </div>
            <div class="status-step" data-status="pronto_para_entrega">
              <img
                src="img/icons/pronto.png"
                alt="Pronto"
                class="status-icon"
              />
              <span class="status-label">Pronto</span>
            </div>
            <div class="status-step" data-status="em_entrega">
              <img
                src="img/icons/EmRota.png"
                alt="Em Rota"
                class="status-icon"
              />
              <span class="status-label">Em Rota</span>
            </div>
            <div class="status-step" data-status="entregue">
              <img
                src="img/icons/entregue.png"
                alt="Entregue"
                class="status-icon"
              />
              <span class="status-label">Entregue</span>
            </div>
          </div>

          <div class="order-info-card">
            <p><strong>Bolo:</strong> <span id="order-cake-name"></span></p>
            <p>
              <strong>Cliente:</strong> <span id="order-client-name"></span>
            </p>
          </div>

          <!-- O mapa será exibido aqui quando o pedido estiver em rota -->
          <div id="map-container" style="display: none">
            <div id="rastreio-map"></div>
            <div class="map-interaction-overlay" id="map-overlay">
              <p>Clique para interagir com o mapa</p>
            </div>
            <!-- Botão de Tela Cheia movido para o canto superior esquerdo -->
            <button
              id="map-fullscreen-btn"
              class="btn-secondary"
              title="Tela Cheia"
            >
              <i class="ph ph-arrows-out"></i>
            </button>
            <div id="nav-hud" class="nav-hud-rastreio">
              <div class="hud-controls"></div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>
    <!-- Importa o plugin MapLibre GL Directions como módulo e expõe globalmente -->
    <script type="module">
      import Directions from "https://unpkg.com/@maplibre/maplibre-gl-directions@0.7.1/dist/maplibre-gl-directions.js";
      window.MapLibreGlDirections = Directions.default || Directions;
    </script>

    <script type="module" src="js/rastreio.js"></script>
  </body>
</html>
