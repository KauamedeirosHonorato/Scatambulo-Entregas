<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Painel Admin - Scatambulo</title>

    <link
      href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />

    <script src="https://unpkg.com/@phosphor-icons/web"></script>
  </head>
  <body>
    <header>
      <div class="header-container">
        <h1>Painel da Ângela</h1>
        <div class="desktop-nav">
          <button id="new-order-button" class="btn-primary">
            <i class="ph ph-plus-circle"></i> Novo Pedido
          </button>
          <button id="print-all-em-preparo-button" class="btn-secondary">
            <i class="ph ph-printer"></i> Imprimir Etiquetas
          </button>
          <button id="read-message-button" class="btn-primary">
            <i class="ph ph-chat-text"></i> Ler Mensagem
          </button>
          <button id="logout-button" class="btn-secondary">
            <i class="ph ph-sign-out"></i> Sair
          </button>
        </div>

        <button class="hamburger-menu" aria-label="Menu">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </button>
      </div>
    </header>

    <nav class="mobile-nav">
      <div class="divider"></div>
    </nav>

    <main class="container">
      <section id="admin-actions-section" style="margin-bottom: 20px">
        <h2 class="section-subtitle">Ações de Manutenção</h2>
        <div class="ios-form-group" style="padding: 10px">
          <button
            id="clear-delivered-button"
            class="btn-admin-action clear-delivered"
          >
            <i class="ph ph-archive" style="font-size: 20px"></i> Limpar
            Entregues
          </button>
          <div class="divider"></div>
          <button
            id="reset-active-deliveries-button"
            class="btn-admin-action reset-deliveries"
          >
            <i class="ph ph-x-circle" style="font-size: 20px"></i> Resetar
            Entregas Ativas
          </button>
          <div class="divider"></div>
          <button
            id="clear-all-orders-button"
            class="btn-admin-action clear-all-orders"
          >
            <i class="ph ph-trash" style="font-size: 20px"></i> Limpar TODOS os
            Pedidos (CUIDADO)
          </button>
        </div>
      </section>

      <section id="map-section">
        <h2><i class="ph ph-map-pin"></i> Rastreamento Entregador</h2>
        <div id="map-container" aria-label="Mapa de acompanhamento">
          <div id="map"></div>

          <div id="map-overlay-top" class="map-overlay-top-entregador">
            <div class="map-info-item map-info-item-border-right">
              <div id="distance-display" class="map-info-value">-- km</div>
              <div class="map-info-label">Distância</div>
            </div>
            <div class="map-info-item">
              <div id="eta-display" class="map-info-value">-- min</div>
              <div class="map-info-label">ETA</div>
            </div>
            <div class="map-info-item map-info-item-border-left">
              <div id="speed-display" class="map-info-value">-- km/h</div>
              <div class="map-info-label">Veloc.</div>
            </div>
          </div>

          <!-- HUD de Navegação (Seguir / Satélite / 3D) -->
          <div id="nav-hud" class="nav-hud-admin">
            <div class="hud-controls">
              <button
                id="follow-entregador-button"
                class="btn-secondary"
                title="Seguir Entregador"
              >
                <i class="ph ph-compass"></i>
              </button>
              <button
                id="satellite-toggle"
                class="btn-secondary"
                title="Modo Satélite"
              >
                <i class="ph ph-globe"></i>
              </button>
              <button
                id="toggle-3d"
                class="btn-secondary"
                title="Visualização 3D"
              >
                <i class="ph ph-cube"></i>
              </button>
            </div>
          </div>
        </div>
      </section>

      <section id="orders-section" style="margin-top: 30px">
        <h2><i class="ph ph-list-checks"></i> Pedidos</h2>
        <!-- Os pedidos serão renderizados aqui em grupos por status -->
        <div id="orders-by-status-container"></div>
      </section>
    </main>

    <div id="modal-container"></div>
    <div id="toast-container"></div>

    <style>
      .order-id-copy {
        cursor: pointer;
        text-decoration: underline;
        text-decoration-style: dotted;
        text-underline-offset: 3px;
        color: var(--ios-link);
      }
      .order-id-copy.copied {
        color: var(--success-color);
        text-decoration: none;
        background-color: #e0f8e0; /* Fundo verde claro */
        padding: 2px 6px;
        border-radius: 4px;
        font-weight: 500;
        transition: background-color 0.2s ease-in-out;
      }
    </style>

    <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>
    <script type="module" src="js/componentLoader.js"></script>
    <script type="module" src="js/admin.js"></script>

    <script>
      // Adiciona a funcionalidade de copiar o código do pedido ao clicar
      document.addEventListener("DOMContentLoaded", () => {
        const ordersContainer = document.getElementById(
          "orders-by-status-container"
        );

        if (ordersContainer) {
          ordersContainer.addEventListener("click", (event) => {
            const target = event.target.closest(".order-id-copy");
            if (!target) return;

            const orderId = target.dataset.orderId;
            navigator.clipboard
              .writeText(orderId)
              .then(() => {
                // Exibe a mensagem "Copiado"
                const originalText = target.innerHTML;
                target.innerHTML = `Copiado!`;
                target.classList.add("copied");

                // Volta ao texto original após 2 segundos
                setTimeout(() => {
                  target.innerHTML = originalText;
                  target.classList.remove("copied");
                }, 2000);
              })
              .catch((err) => {
                console.error("Falha ao copiar o código do pedido: ", err);
              });
          });
        }
      });
    </script>
  </body>
</html>
