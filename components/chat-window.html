<!-- components/chat-window.html -->
<div id="chat-modal" class="chat-modal-container">
  <div class="chat-modal-backdrop" aria-hidden="true"></div>
  <div class="chat-modal-content" role="dialog" aria-modal="true" aria-labelledby="chat-conversation-title" tabindex="-1">
    <!-- iOS-style sheet handle -->
    <div class="sheet-handle" aria-hidden="true"></div>
    <!-- Cabeçalho que muda dinamicamente -->
    <div class="chat-modal-header">
      <div class="header-left-actions">
        <!-- Botão de voltar para a lista de conversas (escondido por padrão) -->
        <button id="chat-back-button" class="back-button" style="display: none;"><i class="ph ph-arrow-left"></i></button>
        <button id="clear-chat-button" class="header-action-button" title="Limpar conversa" style="display: none;"><i class="ph ph-trash"></i></button>
      </div>
      <div class="chat-header-info">
        <i id="chat-header-icon" class="ph ph-chats-circle"></i>
        <h3 id="chat-conversation-title">Conversas</h3>
      </div>
      <div class="header-right-actions">
        <button id="chat-close-button" class="close-button" aria-label="Fechar conversa">&times;</button>
      </div>
    </div>

    <div class="chat-modal-body">
      <!-- 1. Visão da Lista de Conversas (padrão) -->
      <div id="chat-conversation-list-view">
        <div class="chat-conversation-list">
          <!-- A lista de conversas será populada dinamicamente via JavaScript -->
        </div>
      </div>

      <!-- 2. Visão das Mensagens (escondida por padrão) -->
      <div id="chat-messages-view" style="display: none;">
        <div id="chat-messages-list" class="chat-messages-list">
          <!-- As mensagens serão populadas dinamicamente via JavaScript -->
        </div>
        <!-- Typing indicator -->
        <div id="chat-typing-indicator" class="chat-typing-indicator">
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <span id="typing-indicator-text"></span>
        </div>
        <!-- NEW: Reply Preview -->
        <div id="chat-reply-preview" class="chat-reply-preview">
            <div class="reply-preview-content">
                <div class="reply-preview-border"></div>
                <div class="reply-preview-text">
                    <strong id="reply-preview-author"></strong>
                    <span id="reply-preview-snippet"></span>
                </div>
            </div>
            <button id="cancel-reply-btn" class="cancel-reply-btn" title="Cancelar resposta">&times;</button>
        </div>
        <!-- NEW: Image Preview -->
        <div id="chat-image-preview" class="chat-image-preview">
            <div class="image-preview-content">
                <img id="image-preview-element" src="#" alt="Image Preview"/>
            </div>
            <button id="cancel-image-preview-btn" class="cancel-reply-btn" title="Cancelar imagem">&times;</button>
        </div>
        <form id="chat-input-form" class="chat-input-form" autocomplete="off">
          <label for="chat-image-input" class="chat-attach-button" title="Anexar imagem">
            <i class="ph ph-paperclip"></i>
          </label>
          <input type="file" id="chat-image-input" accept="image/*" style="display: none;">

          <!-- Emoji toggle button -->
          <button type="button" id="chat-emoji-button" class="chat-emoji-button" title="Emojis" aria-label="Abrir emojis">
            <i class="ph ph-smiley"></i>
          </button>

          <input id="chat-message-input" type="text" placeholder="Digite uma mensagem..." aria-label="Mensagem" />
          <button type="submit" id="chat-send-button" class="btn-primary" aria-label="Enviar mensagem">
            <i class="ph-bold ph-paper-plane-tilt"></i>
          </button>
        </form>
      </div>
    </div>

    <!-- Emoji Picker (posicionado de forma absoluta em relação ao modal-content) -->
    <div id="emoji-picker" class="emoji-picker" role="dialog" aria-hidden="true">
      <div class="emoji-tabs" role="tablist">
        <button class="emoji-tab active" data-tab="smileys" role="tab" aria-selected="true">Smileys</button>
        <button class="emoji-tab" data-tab="gestures" role="tab" aria-selected="false">Gestos</button>
        <button class="emoji-tab" data-tab="animals" role="tab" aria-selected="false">Animais</button>
      </div>
      <div class="emoji-grid" data-tab-content="smileys"></div>
      <div class="emoji-grid" data-tab-content="gestures" hidden></div>
      <div class="emoji-grid" data-tab-content="animals" hidden></div>
    </div>
    <!-- Live region to announce changes for screen readers -->
    <div id="chat-live-region" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>
  </div>
</div>